rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Permettre la lecture publique uniquement pour le dossier des images de catégories.
    match /category-images/{image} {
      allow read;
    }

    // Les autres chemins restent privés par défaut, sauf si des règles spécifiques sont ajoutées.
    // Par exemple, les images téléversées par les utilisateurs pour les articles ou les avatars.
    match /itemImages/{userId}/{allPaths=**} {
        allow read; // Tout le monde peut voir les images des articles
        allow write: if request.auth != null && request.auth.uid == userId; // Seul l'utilisateur authentifié peut écrire dans son propre dossier
    }

    match /itemVideos/{userId}/{allPaths=**} {
        allow read;
        allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    match /chatAttachments/{threadId}/{userId}/{allPaths=**} {
        allow read;
        allow write: if request.auth != null && request.auth.uid == userId;
    }

    match /avatars/{userId}/{allPaths=**} {
        allow read;
        allow write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
